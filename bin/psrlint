#!/usr/bin/env php
<?php

require_once __DIR__ . '/../vendor/autoload.php';

use PSRLinter\FileLinter;
use PSRLinter\ReportBuilder\ReportBuilder;
use PSRLinter\Exceptions\EmptyListOfFiles;
use PSRLinter\Exceptions\UnexpectedFormatReporter;
use \League\CLImate\CLImate;

$cmd = new Commando\Command();

$cmd->option()
    ->require()
    ->describedAs('File or directory');

$cmd->option('f')
    ->aka('format')
    ->default('txt')
    ->must(function($format) {
        $formats = array('txt', 'json', 'yml');
        return in_array($format, $formats);
    });

$path = $cmd[0];
$format = $cmd['format'];

$cli = new CLImate();
try {
    $linter = new FileLinter();
    $reporter = new ReportBuilder($format);
    $cli->out($reporter->build($linter->lint($path)));
    exit(0);
} catch (EmptyListOfFiles $e){
    $cli->out("Файлов не обнаружено.");
    exit(1);
} catch (UnexpectedFormatReporter $e){
    $cli->out("Неверный формат вывода.");
    exit(1);
}

